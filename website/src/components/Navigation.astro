---
import { Icon } from 'astro-icon/components';
import { t, localePath } from '../i18n/utils';

interface Props {
  lang: string;
}

const { lang } = Astro.props;

const navLinks = [
  { key: 'features', href: '#features' },
  { key: 'sounds',   href: '#gallery' },
  { key: 'quickstart', href: '#quickstart' },
  { key: 'config',   href: '#config' },
  { key: 'platform', href: '#platform' },
];

const altHref = lang === 'ko' ? `${import.meta.env.BASE_URL}` : `${import.meta.env.BASE_URL}ko/`;
const altLabel = lang === 'ko' ? 'EN' : 'KO';
---

<header class="sticky top-0 z-50 backdrop-blur-md bg-hanji/80 border-b border-changho/60 transition-colors duration-200">
  <nav class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">

    <!-- 로고 -->
    <a
      href={localePath('/', lang)}
      class="font-gmarket text-2xl font-bold text-meok hover:text-hobak transition-colors duration-200"
      aria-label={t('nav.logoLabel', lang)}
    >
      {t('hero.logo', lang)}
    </a>

    <!-- 데스크탑 링크 -->
    <ul class="hidden md:flex items-center gap-6 text-sm font-medium text-onggi">
      {navLinks.map(({ key, href }) => (
        <li>
          <a
            href={href}
            class="hover:text-meok hover:text-hobak transition-colors duration-200 py-1"
          >
            {t(`nav.${key}`, lang)}
          </a>
        </li>
      ))}
    </ul>

    <!-- 우측: 언어 토글 + 다크모드 + 햄버거 -->
    <div class="flex items-center gap-3">

      <!-- 언어 토글 -->
      <a
        href={altHref}
        class="hidden md:inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-changho text-sm font-medium text-onggi hover:border-hobak hover:text-hobak transition-colors duration-200"
        aria-label={t('nav.switchTo', lang)}
      >
        <Icon name="ph:globe" class="w-4 h-4" />
        {altLabel}
      </a>

      <!-- 다크 모드 토글 -->
      <button
        id="theme-toggle"
        type="button"
        aria-label={t('nav.themeToggle', lang)}
        class="hidden md:flex w-8 h-8 items-center justify-center rounded-full text-onggi hover:text-hobak hover:bg-changho/60 transition-colors duration-200"
      >
        <!-- 라이트 아이콘 (태양) -->
        <Icon name="ph:sun" id="icon-light" class="hidden w-[18px] h-[18px]" />
        <!-- 다크 아이콘 (달) -->
        <Icon name="ph:moon" id="icon-dark" class="w-[18px] h-[18px]" />
      </button>

      <!-- 모바일 햄버거 -->
      <button
        id="mobile-menu-btn"
        type="button"
        aria-label={t('nav.openMenu', lang)}
        aria-expanded="false"
        aria-controls="mobile-menu"
        class="md:hidden flex w-8 h-8 items-center justify-center rounded text-onggi hover:text-hobak transition-colors duration-200"
      >
        <Icon name="ph:list" id="hamburger-icon" class="w-[22px] h-[22px]" />
        <Icon name="ph:x" id="close-icon" class="hidden w-[22px] h-[22px]" />
      </button>
    </div>
  </nav>

  <!-- 모바일 드롭다운 메뉴 -->
  <div
    id="mobile-menu"
    class="md:hidden absolute left-0 right-0 opacity-0 pointer-events-none -translate-y-2 [transition:opacity_150ms_ease-out,translate_150ms_ease-out] bg-misaek border-t border-changho"
    aria-hidden="true"
  >
    <div class="px-6 py-4 space-y-1">
      {navLinks.map(({ key, href }) => (
        <a
          href={href}
          class="mobile-nav-link block px-4 py-3 rounded-lg text-base font-medium text-onggi hover:text-meok hover:bg-changho/50 active:scale-95 transition-all duration-200"
        >
          {t(`nav.${key}`, lang)}
        </a>
      ))}

      <div class="flex justify-center py-2">
        <div class="w-16 h-px bg-changho"></div>
      </div>

      <div class="flex items-center justify-center gap-3 py-2">
        <!-- 다크모드 토글 (모바일) -->
        <button
          id="theme-toggle-mobile"
          type="button"
          aria-label={t('nav.themeToggle', lang)}
          class="flex w-10 h-10 items-center justify-center rounded-full text-onggi hover:text-hobak hover:bg-changho/60 transition-colors duration-200"
        >
          <Icon name="ph:sun" id="icon-light-mobile" class="hidden w-5 h-5" />
          <Icon name="ph:moon" id="icon-dark-mobile" class="w-5 h-5" />
        </button>

        <!-- 언어 토글 (모바일) -->
        <a
          href={altHref}
          class="inline-flex items-center gap-1.5 px-4 py-2 rounded-full border border-changho text-sm font-medium text-onggi hover:border-hobak hover:text-hobak transition-colors duration-200"
          aria-label={t('nav.switchTo', lang)}
        >
          <Icon name="ph:globe" class="w-4 h-4" />
          {altLabel}
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // 햄버거 메뉴 토글
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerIcon = document.getElementById('hamburger-icon');
  const closeIcon = document.getElementById('close-icon');

  function openMenu() {
    mobileMenu?.classList.remove('opacity-0', 'pointer-events-none', '-translate-y-2');
    mobileMenu?.classList.add('opacity-100', 'pointer-events-auto', 'translate-y-0');
    hamburgerIcon?.classList.add('hidden');
    closeIcon?.classList.remove('hidden');
    menuBtn?.setAttribute('aria-expanded', 'true');
    mobileMenu?.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    mobileMenu?.classList.add('opacity-0', 'pointer-events-none', '-translate-y-2');
    mobileMenu?.classList.remove('opacity-100', 'pointer-events-auto', 'translate-y-0');
    hamburgerIcon?.classList.remove('hidden');
    closeIcon?.classList.add('hidden');
    menuBtn?.setAttribute('aria-expanded', 'false');
    mobileMenu?.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }

  menuBtn?.addEventListener('click', () => {
    const isOpen = menuBtn.getAttribute('aria-expanded') === 'true';
    if (isOpen) { closeMenu(); } else { openMenu(); }
  });

  // 모바일 링크 클릭 시 닫기
  document.querySelectorAll('.mobile-nav-link').forEach((link) => {
    link.addEventListener('click', closeMenu);
  });

  // ESC 키로 닫기
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeMenu();
  });

  // 다크 모드 토글
  const themeToggle = document.getElementById('theme-toggle');
  const iconLight = document.getElementById('icon-light');
  const iconDark = document.getElementById('icon-dark');

  function updateThemeIcons() {
    const isDark = document.documentElement.classList.contains('dark');
    iconLight?.classList.toggle('hidden', !isDark);
    iconDark?.classList.toggle('hidden', isDark);
  }

  updateThemeIcons();

  themeToggle?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    document.documentElement.classList.toggle('dark', !isDark);
    localStorage.setItem('theme', isDark ? 'light' : 'dark');
    updateThemeIcons();
    updateMobileThemeIcons();
  });

  // 모바일 다크 모드 토글
  const themeToggleMobile = document.getElementById('theme-toggle-mobile');
  const iconLightMobile = document.getElementById('icon-light-mobile');
  const iconDarkMobile = document.getElementById('icon-dark-mobile');

  function updateMobileThemeIcons() {
    const isDark = document.documentElement.classList.contains('dark');
    iconLightMobile?.classList.toggle('hidden', !isDark);
    iconDarkMobile?.classList.toggle('hidden', isDark);
  }

  updateMobileThemeIcons();

  themeToggleMobile?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    document.documentElement.classList.toggle('dark', !isDark);
    localStorage.setItem('theme', isDark ? 'light' : 'dark');
    updateThemeIcons();
    updateMobileThemeIcons();
  });
</script>
